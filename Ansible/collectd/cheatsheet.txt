############
# Collectd #
############
git clone https://github.com/giovtorres/ansible-role-collectd
docs (e.g.): https://collectd.org/documentation/manpages/collectd.conf.5.shtml#plugin_write_graphite

Modify /opt/graphite/conf/storage-schemas.conf for collectd data:
(ubuntu2004)
[collectd]
pattern = ^collectd\.
10s:2w, 1m:31d, 5m:1y 

supervisorctl restart carbon-cache

cd /etc/ansible/collectd
ansible-playbook playbooks/install_collectd.yml -i collectd_hosts -e "host=ubuntu2004"
(needs epel-release)

To tailor the plugin templates modify files in /etc/ansible/collectd/playbooks/roles/collectd/templates/plugins

ll /opt/graphite/storage/whisper/carbon/agents/

Global config: /etc/collectd/collectd.conf
Stats config files: /etc/collectd/collectd.d/*.conf

### Grafana ###
https://grafana.com/grafana/dashboards/24
Import dashboard id 24

For this dashboard to work you need the collectd.conf from https://github.com/torkelo/dashboards/blob/master/collectd-graphite-single-server/collectd.conf

# Teams notifications
Image renderer: https://grafana.com/grafana/plugins/grafana-image-renderer
grafana-cli plugins install grafana-image-renderer
systemctl restart grafana-server


### issues to fix
stop collectd if it's running - DONE
SElinux: setsebool -P collectd_tcp_network_connect 1 - DONE
global config needs to be in /etc/collectd.conf - DONE
lib64 dir for centos + collectd-disk install - DONE
load plugin issue on centos - DONE

aggregation plugin: Using string value `True' for boolean option `CalculateAverage' is deprecated and will be removed in future releases. Use unquoted true or false instead.

utils_taskstats: mnl_socket_open(NETLINK_GENERIC) = Permission denied see: https://bugzilla.redhat.com/show_bug.cgi?id=1767184

no disk data for ubuntu1804/client4

test the plugin configuration: collectd -T [-C /etc/collectd.conf]